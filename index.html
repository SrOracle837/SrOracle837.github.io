<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ayush Shah Portfolio</title>
  <meta name="description" content="Graph-based portfolio with force layout navigation and architectural drill-downs." />
  <meta name="theme-color" content="#f8fafc" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdn.tailwindcss.com https://d3js.org; img-src 'self' data:; style-src 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; script-src https://cdn.tailwindcss.com https://d3js.org 'unsafe-inline'" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { fontFamily: { sans: ["Inter", "ui-sans-serif", "system-ui"] } } },
      darkMode: "media",
    };
  </script>

  <!-- D3.js -->
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    html, body { height: 100%; }
    body { background:#f8fafc; color:#374151; overflow:hidden; font-weight:400; }
    .node circle { cursor:pointer; transition: transform .15s ease; }
    .node:focus-visible circle { outline: 2px solid #93C5FD; outline-offset: 2px; }
    .node circle:hover { transform: scale(1.12); }
    .node text { font-size: 12px; font-weight: 300; pointer-events: none; text-anchor: middle; fill: #374151; }
    .link { stroke-opacity: .24; stroke-width: 1px; }
    #main-graph, #lld-svg { width: 100vw; height: 100vh; position: absolute; inset: 0; }
    #lld-overlay {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      z-index: 20;
      transition: opacity .25s ease;
      background: #f8fafc;
    }
    @media (prefers-reduced-motion: reduce) { .node circle { transition:none } #lld-overlay { transition: none } }
  </style>
</head>
<body class="font-sans">

  <!-- Main Graph View -->
  <section id="main-view" class="relative" aria-labelledby="site-title">
    <header class="absolute inset-x-0 top-0 p-6 md:p-8 z-10 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div class="max-w-xl">
        <h1 id="site-title" class="text-2xl md:text-3xl font-medium">Ayush Shah</h1>
        <p class="text-gray-600 mt-2 font-light">Hover to explore connections; click a project to open its architecture. Use Tab/Enter for keyboard. Press <kbd>/</kbd> to search.</p>
      </div>
      <div class="flex items-center gap-2">
        <input id="search" placeholder="Search…" class="px-3 py-2 rounded-lg bg-gray-100 text-gray-700 text-sm placeholder-gray-400 focus:outline-none focus:ring focus:ring-sky-300/40" aria-label="Search nodes" />
        <button id="reset" class="px-3 py-2 rounded-lg bg-gray-100 text-gray-700 text-sm hover:bg-gray-200">Reset</button>
      </div>
    </header>

    <figure aria-label="Portfolio knowledge graph">
      <svg id="main-graph" role="img" aria-describedby="graph-desc">
        <title>Interactive portfolio graph</title>
        <desc id="graph-desc">Projects, experience, education, and extracurricular nodes connected by relationships.</desc>
      </svg>
    </figure>

    <!-- Legend -->
    <div class="absolute bottom-4 left-4 z-10 flex flex-wrap items-center gap-3 text-xs">
      <span class="inline-flex items-center gap-1"><span class="inline-block w-3 h-3 rounded-full bg-sky-200"></span> Project</span>
      <span class="inline-flex items-center gap-1"><span class="inline-block w-3 h-3 rounded-full bg-pink-200"></span> Experience</span>
      <span class="inline-flex items-center gap-1"><span class="inline-block w-3 h-3 rounded-full bg-emerald-200"></span> Skill</span>
      <span class="inline-flex items-center gap-1"><span class="inline-block w-3 h-3 rounded-full bg-yellow-200"></span> Education</span>
      <span class="inline-flex items-center gap-1"><span class="inline-block w-3 h-3 rounded-full bg-purple-200"></span> Extracurricular</span>
    </div>
  </section>

  <!-- LLD View -->
  <section id="lld-overlay" class="hidden opacity-0" aria-live="polite">
    <div class="absolute top-0 left-0 p-6 md:p-8 z-20 space-y-2">
      <div class="flex items-center gap-2">
        <button id="back" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded-lg shadow-lg transition-transform transform hover:scale-[1.03]" aria-label="Back to main graph">← Back</button>
        <button id="download-svg" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded-lg shadow-lg" aria-label="Download architecture as SVG">Download SVG</button>
      </div>
      <h2 id="lld-title" class="text-2xl md:text-3xl font-medium"></h2>
      <p class="text-gray-600 font-light">Pan and zoom to explore. Scroll to zoom; drag empty space to pan.</p>
    </div>
    <svg id="lld-svg" role="img">
      <title>Project architecture tree</title>
    </svg>
  </section>

  <!-- Data (can be swapped for external JSON later) -->
  <script type="application/json" id="portfolio-data">
  {
    "mainGraph": {
      "nodes": [
        { "id": "Education", "type": "education", "group": "education" },
        { "id": "Carnegie Mellon University", "type": "education", "group": "education" },
        { "id": "Dwarkadas J. Sanghvi College of Engineering", "type": "education", "group": "education" },
        { "id": "Projects", "type": "skill", "group": "project" },
        { "id": "Distributed Consensus Framework (RPC + RAFT)", "type": "project", "group": "project" },
        { "id": "Honeynet as a Service", "type": "project", "group": "project" }
      ],
      "links": [
        { "source": "Education", "target": "Carnegie Mellon University" },
        { "source": "Education", "target": "Dwarkadas J. Sanghvi College of Engineering" },
        { "source": "Projects", "target": "Distributed Consensus Framework (RPC + RAFT)" },
        { "source": "Projects", "target": "Honeynet as a Service" }
      ]
    },
    "projectArchitectures": {
      "Distributed Consensus Framework (RPC + RAFT)": { "svg": "architectures/distributed-consensus.svg" },
      "Honeynet as a Service": { "svg": "architectures/honeynet.svg" },
      "Stegnoflage": { "name": "Stegnoflage", "children": [] },
      "INDIE DFIR": { "name": "INDIE DFIR", "children": [] }
    },
    "nodeOverlays": {
      "Education": {
        "nodes": [
          { "id": "Carnegie Mellon University", "group": "education" },
          { "id": "Dwarkadas J. Sanghvi College of Engineering", "group": "education" }
        ]
      },
      "Carnegie Mellon University": {
        "nodes": [
          { "id": "Coursework", "group": "education" }
        ],
        "links": [
        ]
      },
      "Dwarkadas J. Sanghvi College of Engineering": {
        "nodes": [
          { "id": "Coursework", "group": "education" },
          { "id": "DJS Robocon", "group": "extracurricular" },
          { "id": "DJS Karting", "group": "extracurricular" },
          { "id": "GDSC Cybersecurity Team", "group": "extracurricular" },
          { "id": "GDSC IoT/AR/VR", "group": "extracurricular" }
        ],
        "links": [
          { "source": "Dwarkadas J. Sanghvi College of Engineering", "target": "Coursework" },
          { "source": "Dwarkadas J. Sanghvi College of Engineering", "target": "DJS Robocon" },
          { "source": "Dwarkadas J. Sanghvi College of Engineering", "target": "DJS Karting" },
          { "source": "Dwarkadas J. Sanghvi College of Engineering", "target": "GDSC Cybersecurity Team" },
          { "source": "Dwarkadas J. Sanghvi College of Engineering", "target": "GDSC IoT/AR/VR" }
        ]
      },
      "Coursework@Carnegie Mellon University": {
        "nodes": [
          { "id": "Introduction to Computer Security", "group": "skill" },
          { "id": "Network Security", "group": "skill" },
          { "id": "Binary Analysis", "group": "skill" },
          { "id": "Penetration Testing", "group": "skill" },
          { "id": "Incident Response & Digital Forensics", "group": "skill" }
        ]
      },
      "Coursework@Dwarkadas J. Sanghvi College of Engineering": {
        "nodes": [
          { "id": "Data Structures and Algorithms", "group": "skill" },
          { "id": "Operating Systems", "group": "skill" },
          { "id": "Database Management Systems", "group": "skill" },
          { "id": "Computer Networks", "group": "skill" },
          { "id": "Microprocessors", "group": "skill" },
          { "id": "Theory of Computation", "group": "skill" }
        ]
      }
    }
  }
  </script>

  <script>
  // Utilities
  const $ = (sel) => document.querySelector(sel);
  const getId = (d) => typeof d === 'object' ? d.id : d;

  document.addEventListener('DOMContentLoaded', () => {
    const data = JSON.parse(document.getElementById('portfolio-data').textContent);

    const width = innerWidth, height = innerHeight;
    const svg = d3.select('#main-graph').attr('width', width).attr('height', height)
      .attr('viewBox', `0 0 ${width} ${height}`).attr('preserveAspectRatio', 'xMidYMid meet');

    const color = d3.scaleOrdinal().domain(['project','experience','skill','education','extracurricular']).range(['#BAE6FD','#FBCFE8','#A7F3D0','#FEF3C7','#E9D5FF']);

    // Forces
    const simulation = d3.forceSimulation(data.mainGraph.nodes)
      .force('link', d3.forceLink(data.mainGraph.links).id(d => d.id).distance(120))
      .force('charge', d3.forceManyBody().strength(-380))
      .force('center', d3.forceCenter(width/2, height/2))
      .force('collision', d3.forceCollide().radius(d => d.type === 'project' ? 40 : 24).strength(0.9));

    // Links
    const link = svg.append('g').attr('stroke', '#94A3B8').selectAll('line')
      .data(data.mainGraph.links).join('line').attr('class','link');

    // Nodes
    const node = svg.append('g').selectAll('g')
      .data(data.mainGraph.nodes).join('g')
      .attr('class','node')
      .attr('tabindex', 0)
      .attr('role','button')
      .attr('aria-label', d => `${d.type}: ${d.id}`);

    node.append('title').text(d => d.id);

    node.append('circle')
      .attr('r', d => d.type === 'project' ? 16 : 10)
      .attr('fill', d => color(d.group))
      .attr('stroke', d => d.type === 'project' ? '#94A3B8' : 'none')
      .attr('stroke-width', d => d.type === 'project' ? 2 : 0)
      .on('click', (_, d) => {
        if (data.nodeOverlays && data.nodeOverlays[d.id]) {
          renderSubgraph(d.id);
        } else if (d.type === 'project') {
          openLLD(d.id);
        }
      })
      .on('keydown', (event, d) => {
        if (event.key === 'Enter' || event.key === ' ') {
          if (data.nodeOverlays && data.nodeOverlays[d.id]) {
            renderSubgraph(d.id);
          } else if (d.type === 'project') {
            openLLD(d.id);
          }
        }
      });

    node.append('text').text(d => d.id).attr('dy', d => d.type === 'project' ? -22 : -14);

    node.call(d3.drag()
      .on('start', (event, d) => { if (!event.active) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; })
      .on('drag', (event, d) => { d.fx = event.x; d.fy = event.y; })
      .on('end', (event, d) => { if (!event.active) simulation.alphaTarget(0); d.fx = null; d.fy = null; })
    );

    // Build quick lookup for hover highlighting — robust for strings/objects
    const linked = {};
    data.mainGraph.links.forEach(l => { linked[`${getId(l.source)},${getId(l.target)}`] = 1; });
    const isConnected = (a, b) => linked[`${a.id},${b.id}`] || linked[`${b.id},${a.id}`] || a.id === b.id;

    node.on('mouseover', (_, d) => {
      node.style('opacity', o => isConnected(d, o) ? 1 : 0.25);
      link.style('stroke-opacity', o => (getId(o.source) === d.id || getId(o.target) === d.id) ? 0.6 : 0.08);
    }).on('mouseout', () => {
      node.style('opacity', 1); link.style('stroke-opacity', 0.24);
    });

    simulation.on('tick', () => {
      link.attr('x1', d => d.source.x)
          .attr('y1', d => d.source.y)
          .attr('x2', d => d.target.x)
          .attr('y2', d => d.target.y);
      node.attr('transform', d => `translate(${d.x},${d.y})`);
    });

    // Resize handler keeps layout responsive
    addEventListener('resize', () => {
      const w = innerWidth, h = innerHeight;
      svg.attr('width', w).attr('height', h).attr('viewBox', `0 0 ${w} ${h}`);
      simulation.force('center', d3.forceCenter(w/2, h/2)).alpha(0.3).restart();
    });

    // Simple search/filter
    const search = $('#search'), reset = $('#reset');
    const applyFilter = (q) => {
      const query = (q || '').trim().toLowerCase();
      if (!query) { node.style('display', null); link.style('display', null); return; }
      node.style('display', d => d.id.toLowerCase().includes(query) ? null : 'none');
      const visible = new Set();
      data.mainGraph.nodes.forEach(n => { if (n.id.toLowerCase().includes(query)) visible.add(n.id); });
      link.style('display', l => visible.has(getId(l.source)) || visible.has(getId(l.target)) ? null : 'none');
    };
    search.addEventListener('input', e => applyFilter(e.target.value));
    document.addEventListener('keydown', e => { if (e.key === '/') { e.preventDefault(); search.focus(); } });
    reset.addEventListener('click', () => { search.value = ''; applyFilter(''); });

    // Deep link routing via hash: #project=Project%20Alpha
    function openLLD(name) { location.hash = `project=${encodeURIComponent(name)}`; }
    function readRoute() {
      const m = location.hash.match(/project=([^&]+)/);
      if (m) renderLLD(decodeURIComponent(m[1]));
      else closeLLD();
    }
    addEventListener('hashchange', readRoute);

    // LLD rendering
    const lldSvg = d3.select('#lld-svg');
    const overlay = document.getElementById('lld-overlay');
    const overlayStack = [];

    function renderLLD(projectName, skipPush) {
      const arch = data.projectArchitectures[projectName];
      if (!arch) return;

      if (!skipPush) overlayStack.push(projectName);

      document.getElementById('lld-title').textContent = `Architecture: ${projectName}`;
      lldSvg.selectAll('*').remove();

      const w = innerWidth, h = innerHeight; lldSvg.attr('width', w).attr('height', h);

      if (arch.svg) {
        fetch(arch.svg).then(r => r.text()).then(txt => {
          const parser = new DOMParser();
          const doc = parser.parseFromString(txt, 'image/svg+xml');
          const svgEl = doc.documentElement;
          lldSvg.html(svgEl.innerHTML);
          Array.from(svgEl.attributes).forEach(attr => lldSvg.attr(attr.name, attr.value));
          overlay.classList.remove('hidden');
          requestAnimationFrame(() => overlay.classList.remove('opacity-0'));
        });
        return;
      }

      lldSvg.attr('viewBox', `0 0 ${w} ${h}`).attr('preserveAspectRatio', 'xMidYMid meet');

      const root = d3.hierarchy(arch);
      const tree = d3.tree().nodeSize([28, 180]);
      tree(root);

      // Container for pan/zoom
      const rootG = lldSvg.append('g');
      const baseG = rootG.append('g').attr('transform', 'translate(180,60)');

      // Links – use a horizontal link generator
      const linkGen = d3.linkHorizontal().x(d => d.y).y(d => d.x);
      baseG.selectAll('.link').data(root.links()).join('path')
        .attr('class', 'link').attr('fill','none').attr('stroke', '#94A3B8').attr('stroke-width', 1.5)
        .attr('d', linkGen);

      // Nodes
      const nodes = baseG.selectAll('.node').data(root.descendants()).join('g')
        .attr('class', 'node').attr('transform', d => `translate(${d.y},${d.x})`);

      nodes.append('circle').attr('r', d => d.children ? 7.5 : 5)
        .attr('fill', d => d.children ? '#93C5FD' : '#E5E7EB')
        .attr('stroke', '#94A3B8').attr('stroke-width', 1.2);

      nodes.append('text').text(d => d.data.name)
        .attr('dy', '0.32em').attr('x', d => d.children ? -14 : 14)
        .attr('text-anchor', d => d.children ? 'end' : 'start')
        .attr('fill', '#374151').attr('font-size', 14).attr('font-weight', 400);

      // Zoom + pan (preserve the base translate)
      const zoom = d3.zoom().scaleExtent([0.3, 3]).on('zoom', (ev) => {
        const t = ev.transform; rootG.attr('transform', `translate(${t.x},${t.y}) scale(${t.k})`);
      });
      lldSvg.call(zoom).call(zoom.transform, d3.zoomIdentity.translate(0,0).scale(1));

      // Show overlay
      overlay.classList.remove('hidden'); requestAnimationFrame(() => overlay.classList.remove('opacity-0'));
    }

    function renderSubgraph(nodeName, skipPush) {
      const sub = data.nodeOverlays[nodeName];
      if (!sub) return;

      if (!skipPush) overlayStack.push(nodeName);

      document.getElementById('lld-title').textContent = nodeName;
      lldSvg.selectAll('*').remove();

      const w = innerWidth, h = innerHeight;
      lldSvg.attr('width', w).attr('height', h)
        .attr('viewBox', `0 0 ${w} ${h}`).attr('preserveAspectRatio', 'xMidYMid meet');

      const nodes = [{ id: nodeName, group: 'education' }, ...(sub.nodes || [])];
      const links = (sub.links && sub.links.length)
        ? sub.links.map(l => ({ source: l.source, target: l.target }))
        : (sub.nodes || []).map(n => ({ source: nodeName, target: n.id }));

      const simulation = d3.forceSimulation(nodes)
        .force('link', d3.forceLink(links).id(d => d.id).distance(80))
        .force('charge', d3.forceManyBody().strength(-200))
        .force('center', d3.forceCenter(w/2, h/2))
        .force('collision', d3.forceCollide().radius(d => 20 + d.id.length * 2));

      const link = lldSvg.append('g').selectAll('line').data(links).join('line')
        .attr('class', 'link').attr('stroke', '#94A3B8').attr('stroke-width', 1.5);

      const node = lldSvg.append('g').selectAll('g').data(nodes).join('g')
        .attr('class', 'node')
        .call(d3.drag()
          .on('start', (event, d) => { if (!event.active) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; })
          .on('drag', (event, d) => { d.fx = event.x; d.fy = event.y; })
          .on('end', (event, d) => { if (!event.active) simulation.alphaTarget(0); d.fx = null; d.fy = null; })
        );

      node.append('circle').attr('r', 8)
        .attr('fill', d => color(d.group || 'education'))
        .attr('stroke', '#94A3B8').attr('stroke-width', 1.2);

      node.append('text').text(d => d.id)
        .attr('dy', '0.32em').attr('x', 12)
        .attr('font-size', 12).attr('fill', '#374151');

      node.on('click', (_, d) => {
        if (data.nodeOverlays && data.nodeOverlays[d.id]) renderSubgraph(d.id);
      });

      simulation.on('tick', () => {
        link.attr('x1', d => d.source.x)
            .attr('y1', d => d.source.y)
            .attr('x2', d => d.target.x)
            .attr('y2', d => d.target.y);
        node.attr('transform', d => `translate(${d.x},${d.y})`);
      });

      overlay.classList.remove('hidden'); requestAnimationFrame(() => overlay.classList.remove('opacity-0'));
    }

    function closeLLD() {
      overlayStack.length = 0;
      overlay.classList.add('opacity-0');
      setTimeout(() => overlay.classList.add('hidden'), 180);
    }

    document.getElementById('back').addEventListener('click', () => {
      overlayStack.pop();
      if (overlayStack.length > 0) {
        const prev = overlayStack[overlayStack.length - 1];
        if (data.nodeOverlays && data.nodeOverlays[prev]) {
          renderSubgraph(prev, true);
        } else {
          history.pushState('', document.title, window.location.pathname + window.location.search);
          renderLLD(prev, true);
        }
      } else {
        history.pushState('', document.title, window.location.pathname + window.location.search);
        closeLLD();
      }
    });

    // Export SVG of LLD
    document.getElementById('download-svg').addEventListener('click', () => {
      const svgEl = document.getElementById('lld-svg');
      const blob = new Blob([new XMLSerializer().serializeToString(svgEl)], { type: 'image/svg+xml;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = (document.getElementById('lld-title').textContent || 'architecture') + '.svg'; a.click();
      URL.revokeObjectURL(url);
    });

    // Initial route (supports direct links)
    readRoute();
  });
  </script>
</body>
</html>
